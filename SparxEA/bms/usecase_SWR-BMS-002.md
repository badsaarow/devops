# Use Case: 배터리 보호 기능 (SWR-BMS-002)

## Brief Description

배터리의 안전한 작동을 위해 전압, 전류, 온도를 모니터링하고 위험 상황 발생 시 적절한 보호 동작을 수행한다.

## Primary Actor

- Battery Management System (BMS)

## Secondary Actors

- Vehicle Control Unit (VCU)
- Battery Pack
- Current Sensor
- Temperature Sensor
- Voltage Sensor

## Preconditions

1. BMS가 정상 작동 중이다
2. 모든 센서가 정상 작동 중이다
3. 배터리 시스템이 활성화되어 있다

## Main Success Scenario

1. BMS가 주기적으로 배터리 상태를 모니터링한다
   - 셀 전압: 200ms 주기
   - 전류: 100ms 주기
   - 온도: 1초 주기
2. 모든 측정값이 안전 범위 내에 있음을 확인한다
3. VCU에 정상 상태 신호를 전송한다
4. 배터리 정상 작동을 유지한다

## Alternate Paths

### A1. 과전압 감지

1. 셀 전압이 4.2V를 초과하는 것을 감지
2. 즉시 충전을 차단
3. VCU에 과전압 경고 신호 전송
4. 전압이 안전 범위로 복귀할 때까지 충전 금지
5. 정상 전압 복귀 시 메인 시나리오로 복귀

### A2. 저전압 감지

1. 셀 전압이 2.5V 미만인 것을 감지
2. 즉시 방전을 차단
3. VCU에 저전압 경고 신호 전송
4. 전압이 안전 범위로 복귀할 때까지 방전 금지
5. 정상 전압 복귀 시 메인 시나리오로 복귀

### A3. 과전류 감지 (충전)

1. 충전 전류가 200A를 초과하는 것을 감지
2. 즉시 충전을 차단
3. VCU에 과전류 경고 신호 전송
4. 전류가 안전 범위로 복귀할 때까지 대기
5. 정상 전류 복귀 시 메인 시나리오로 복귀

### A4. 과전류 감지 (방전)

1. 방전 전류가 350A를 초과하는 것을 감지
2. 즉시 방전을 차단
3. VCU에 과전류 경고 신호 전송
4. 전류가 안전 범위로 복귀할 때까지 대기
5. 정상 전류 복귀 시 메인 시나리오로 복귀

### A5. 고온 감지

1. 셀 온도가 60°C를 초과하는 것을 감지
2. 즉시 충/방전을 차단
3. VCU에 과열 경고 신호 전송
4. 온도가 안전 범위로 복귀할 때까지 대기
5. 정상 온도 복귀 시 메인 시나리오로 복귀

### A6. 저온 감지

1. 셀 온도가 -20°C 미만인 것을 감지
2. 충전 동작 제한
3. VCU에 저온 경고 신호 전송
4. 온도가 안전 범위로 복귀할 때까지 충전 제한 유지
5. 정상 온도 복귀 시 메인 시나리오로 복귀

## Exception Paths

### E1. 센서 오류 감지

1. 센서 데이터 이상 또는 통신 오류 감지
2. 예비 센서로 전환 시도
3. 예비 센서도 실패할 경우:
   - 즉시 모든 충/방전 차단
   - VCU에 센서 고장 경고 신호 전송
   - Fail-safe 모드 활성화
4. 에러 로그 기록
5. 정비 필요 상태로 전환

### E2. 보호 동작 실패

1. 보호 명령 실행 실패 감지
2. 백업 차단 시스템 활성화
3. VCU에 긴급 차단 신호 전송
4. 모든 배터리 동작 즉시 중지
5. 에러 로그 기록
6. 정비 필요 상태로 전환

### E3. 통신 두절

1. VCU와의 통신 두절 감지
2. 독립적으로 보호 동작 수행
3. 통신 복구 시도
4. 에러 로그 기록
5. 제한된 안전 모드로 작동

## Postconditions

1. 배터리가 안전한 상태로 유지됨
2. 모든 보호 이벤트가 로그에 기록됨
3. VCU에 현재 상태가 정확히 전달됨

## Special Requirements

- ASIL-D 안전 요구사항 준수
- 보호 동작 응답 시간: 10ms 이내
- 모든 보호 동작은 중복 검증 필요
- 모든 이벤트는 블랙박스 로깅 필요

## Frequency of Occurrence

- 정상 모니터링: 지속적 (100ms ~ 1s 주기)
- 보호 동작 발생: 드물게 (비정상 상황 시)
