# Battery Monitoring Use Case Scenario (UC-BMS-MON-001)

## Use Case Name
배터리 셀 모니터링 및 측정

## Actor
- Primary Actor: BMS Controller
- Secondary Actor: Vehicle Control Unit (VCU)
- Secondary Actor: Diagnostic Tool

## Preconditions
1. BMS 시스템이 정상 작동 중
2. 모든 센서가 정상 상태
3. 전원 공급이 안정적

## Post-conditions
1. 배터리 측정값이 시스템에 기록됨
2. 측정 데이터가 VCU에 전송됨
3. 이상 상태 발생 시 경고/오류 메시지 생성

## Basic Path (Happy Path)
1. BMS가 200ms 주기로 각 셀의 전압 측정을 시작
2. BMS가 1초 주기로 각 셀의 온도 측정을 시작
3. BMS가 100ms 주기로 배터리 팩 전류를 측정
4. 측정된 모든 값이 정상 범위 내에 있음을 확인
   - 전압: 2.5V ~ 4.2V
   - 온도: -40°C ~ 85°C
   - 전류: -400A ~ +400A
5. 측정된 데이터를 내부 메모리에 저장
6. CAN 통신을 통해 VCU에 데이터 전송
7. 다음 측정 주기까지 대기

## Alternate Paths

### Alternate Path 1: 센서 재보정 필요
1. 전압 센서의 측정값이 보정 허용 오차(±5mV) 범위 초과 감지
2. 센서 보정 루틴 실행
3. 보정 성공 시 정상 측정 재개
4. 보정 결과를 진단 로그에 기록

### Alternate Path 2: 통신 재시도
1. VCU로의 CAN 통신 실패 감지
2. 100ms 대기 후 통신 재시도
3. 최대 3회 재시도 수행
4. 통신 성공 시 정상 경로로 복귀

### Alternate Path 3: 저전력 모드 전환
1. 차량이 장시간(30분 이상) 대기 상태 감지
2. 측정 주기를 저전력 모드로 변경
   - 전압: 1초 주기
   - 온도: 5초 주기
   - 전류: 500ms 주기
3. 차량 활성화 신호 수신 시 정상 측정 주기로 복귀

### Alternate Path 4: 진단 모드 전환
1. 진단 툴 연결 감지
2. 측정 주기를 진단 모드로 변경
3. 상세 측정 데이터를 진단 툴로 전송
4. 진단 툴 연결 해제 시 정상 모드로 복귀

## Exceptional Paths

### Exception 1: 센서 고장
1. 특정 센서에서 유효하지 않은 값 감지
2. 해당 센서 상태를 "고장"으로 표시
3. 백업 센서로 전환 (가능한 경우)
4. DTC(Diagnostic Trouble Code) 생성
5. VCU에 센서 고장 상태 전송
6. 제한된 측정 모드로 작동 계속

### Exception 2: 심각한 측정 오류
1. 연속 3회 이상 측정값이 유효 범위를 크게 벗어남
2. 해당 측정 채널을 비활성화
3. 안전 모드로 전환
4. 고장 정보를 EEPROM에 기록
5. VCU에 긴급 상황 메시지 전송
6. 운전자 경고 신호 활성화

### Exception 3: 시스템 메모리 오류
1. 데이터 저장 중 메모리 오류 발생
2. 메모리 무결성 검사 수행
3. 백업 메모리 영역으로 전환
4. 시스템 리셋 필요성 평가
5. 오류 로그 생성
6. 제한된 기능으로 작동 유지

## Business Rules
1. 모든 측정은 지정된 정확도 내에서 수행되어야 함
2. 센서 오류 발생 시 반드시 로그를 남겨야 함
3. 안전과 관련된 측정값 오류는 즉시 VCU에 보고되어야 함
4. 모든 측정 데이터는 타임스탬프와 함께 저장되어야 함

## Special Requirements
1. 측정 응답 시간: 10ms 이내
2. 데이터 정확도: ISO 26262 ASIL-C 요구사항 충족
3. 메모리 사용량: 측정 데이터당 최대 32바이트
4. 센서 동기화: 최대 허용 오차 ±1ms

## Notes and Issues
1. 온도 센서의 응답 시간 지연 고려 필요
2. 전류 센서의 노이즈 필터링 로직 검토 필요
3. 다중 센서 데이터 융합 알고리즘 최적화 필요