# 유스케이스: 통신 인터페이스 (SWR-BMS-004)

## 개요

- 유스케이스 ID: UC-BMS-004
- 액터:
  - BMS 컨트롤러
  - 차량 ECU
  - 진단 장비
- 선행조건:
  - BMS 시스템 정상 작동
  - CAN 버스 초기화 완료
  - 진단 세션 설정 가능
- 후행조건: 안정적인 통신 유지

## Basic Path (정상 경로)

### CAN 통신

1. CAN 버스 초기화 (500kbps)
2. 주기적 메시지 송신
   - 배터리 상태 데이터 (SOC, SOH, SOF)
   - 전압, 전류, 온도 데이터
   - 경고 및 오류 상태
3. 수신 메시지 처리
   - 제어 명령 수신
   - 파라미터 설정 요청
4. 통신 상태 모니터링

### 진단 통신

1. 진단 요청 수신 감지
2. UDS 세션 설정
3. 진단 서비스 제공
   - 고장 코드 읽기
   - 실시간 데이터 스트림
   - 파라미터 설정
4. 진단 응답 전송

## Alternate Paths (대체 경로)

### A1. 우선순위 메시지 처리

1. 고우선순위 메시지 감지
2. 현재 통신 일시 중단
3. 우선순위 메시지 즉시 처리
4. 일반 통신 재개

### A2. 진단 세션 전환

1. 진단 세션 전환 요청 수신
2. 현재 세션 종료
3. 새로운 세션 보안 레벨 확인
4. 새 세션 설정 및 확인

### A3. 통신 부하 관리

1. 버스 부하 임계값 초과 감지
2. 비중요 메시지 전송 주기 조정
3. 버스 부하 모니터링
4. 정상 부하 시 원래 주기 복원

## Exception Paths (예외 경로)

### E1. CAN 버스 오류

1. CAN 버스 오류 감지
   - 버스 오프
   - 에러 패시브 상태
2. 자동 복구 시도
3. 오류 상태 기록
4. 지속적 오류 시 백업 통신 모드 전환

### E2. 메시지 손실 처리

1. 메시지 손실 또는 타임아웃 감지
2. 재전송 메커니즘 활성화
3. 연속 실패 시 오류 보고
4. 통신 품질 저하 경고

### E3. 보안 위반 시도

1. 비인가 접근 시도 감지
2. 해당 요청 거부
3. 보안 위반 이벤트 기록
4. 필요시 통신 제한 모드 전환

### E4. 진단 서비스 실패

1. 진단 서비스 실행 실패 감지
2. 부정적 응답 코드(NRC) 전송
3. 실패 원인 기록
4. 진단 세션 정리

## 특수 요구사항

### 통신 성능

- CAN 메시지 지연시간: ≤ 10ms
- 진단 응답시간: ≤ 50ms
- 버스 부하율: ≤ 40%
- 오류 프레임 비율: ≤ 0.1%

### 안전성 요구사항 (ASIL-B)

- 메시지 무결성 검증
- 통신 오류 감지 및 복구
- 진단 통신 보안
- 중요 메시지 확인응답 필수

### 진단 기능

- UDS 서비스 지원
  - 세션 제어 (0x10)
  - 보안 접근 (0x27)
  - 고장 코드 읽기 (0x19)
  - 데이터 읽기 (0x22)
  - 데이터 쓰기 (0x2E)
  - 루틴 제어 (0x31)

### 모니터링 요구사항

- 통신 상태 실시간 모니터링
- 버스 부하 모니터링
- 오류 카운터 관리
- 통신 로그 저장
